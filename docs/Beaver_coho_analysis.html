<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>AK HCD Short Reports - Coho-Beaver Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><link rel="stylesheet" href="styles.css">
</head>
<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">AK HCD Short Reports</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./Beaver_coho_analysis.html" rel="" target="" aria-current="page">
 <span class="menu-text">Coho-Beaver Analysis</span></a>
  </li>  
</ul>
<div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose"><strong>Purpose</strong></a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods"><strong>Methods</strong></a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results"><strong>Results</strong></a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><strong>References</strong></a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Coho-Beaver Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p><strong>Authors:</strong> Mallarie Yeager and Mason Smith</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Beaver_pond.png" class="lightbox img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Beaver pond in Alaska</strong> <a href="https://alaskamagazine.com/authentic-alaska/wildlife-nature/beavers-make-their-mark-on-alaska/">photo reference</a></figcaption></figure>
</div>
<section id="purpose" class="level3 justify"><h3 class="anchored" data-anchor-id="purpose"><strong>Purpose</strong></h3>
<p>In collaboration with folks at HCD (Luke Byker and Julianne Rosset), Mason Smith and Mallarie Yeager analyzed coho success within beaver bonds and downstream reference sites within 7 streams. In this “Short Report”, we illustrate our methods on analysis, written results with corresponding figures and a small discussion on specific future variables one might want to consider if expanding on this work. This report will be integrated into our manuscript which we plan to submit soon. Citations and links will be updated once available.</p>
<section id="objective-to-understand-how-beaver-pond-presence-influences-coho-overwintering-success" class="level5"><h5 class="anchored" data-anchor-id="objective-to-understand-how-beaver-pond-presence-influences-coho-overwintering-success"><strong><em>Objective: To understand how beaver pond presence influences coho overwintering success</em></strong></h5>
<p><strong>Question 1:</strong> Does beaver pond presence enhance coho catch per unit trap (CPUT)?</p>
<p><strong>Question 2:</strong> Are there environmental drivers which may explain beaver pond enhancement?</p>
</section></section><div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="beaver.jpg" class="lightbox img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Beaver</strong> <a href="https://faculty.ung.edu/jhamilton/tumblingcreek/beaverpond/beaverpond.htm">photo reference</a></figcaption></figure>
</div>
<section id="methods" class="level3"><h3 class="anchored" data-anchor-id="methods"><strong>Methods</strong></h3>
<section id="analyses" class="level5"><h5 class="anchored" data-anchor-id="analyses"><em>Analyses</em></h5>
<p>To analyze whether beaver ponds enhance juvenile coho presence in this study, we used a one-way paired T-test to test whether catch per unit trap (CPUT) of coho was significantly higher at beaver ponds compared to reference locations within a site (i.e., river stem). The paired design of the paired one-way T-test allows us to address the non-independence within a site, while the one-way allows for a hypothesis driven test that beaver ponds result in more coho than their paired reference locations. Once testing whether beaver ponds enhance coho CPUT, we can examine whether specific environmental factors explain beaver pond enhancement through correlative models. We used generalized additive models (GAMs) to examine the relationship between coho beaver abundance and environmental conditions within beaver ponds or reference locations within a site. The site (i.e.&nbsp;river stem) of each dam was treated as a random effect due to the non-independence of treatment types (above vs below dams) within each river stem. This allowed for examining relationships between the coho beaver abundance and the fixed effects, while also taking into account the variation from random effects occurring at different levels within the population (West et al.&nbsp;2022). Before fitting models, we examined covariates for collinearity using correlation coefficients (threshold &lt; 0.7) and the variance inflation factor (VIF, threshold &lt; 10) (Dormann et al.&nbsp;2013). Models were fit with a Tweedie distribution and log-linked to the response variable using the gam function in the ‘mgcv’ package in R (Wood, 2011). We tested the full covariate model then removed poor fitting covariates until we received the best fit model. We looked for the highest percent deviance explained while minimizing the Akaike Information Criterion (AIC) value.</p>
</section></section><section id="results" class="level3"><h3 class="anchored" data-anchor-id="results"><strong>Results</strong></h3>
<p>Although there was variation in CPUT across paired sites (i.e.&nbsp;river stems), we overall found beaver ponds had on average significantly higher catch per unit trap (CPUT) of coho compared to their paired reference locations (one-way paired T-test: t(6) = 3.22, p-value = 0.009; Figure 1).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Figure1_CPUTofCoho_across_treatment_site.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><strong>Figure 1.</strong> The CPUT of coho across site and treatment. The distribution of the raw CPUT of coho data across treatment is shown via the violin plot and the jittered opaque dots by site color. The site mean CPUT of coho across treatment is represented via the solid color points and the paired design of the sites across treatment via the connected lines. The overall mean CPUT of coho across treatment is shown by the black diamond points.</figcaption></figure>
</div>
<p>As beaver ponds do in fact enhance coho CPUT, we next looked at which environmental variables might explain the variation in CPUT across beaver pond vs reference and site. Through performing model selection via removing poor fitting covariates, we found our best fitting model via percent deviance explained and AIC selection (Table 1). Our best fitting model consisted of the following environmental factors: dissolved oxygen, temperature, water depth, distance from mainstream river stem, ice thickness and pH (Table 1).</p>
<p><strong>Table 1.</strong> Summary of model selection information of the top 5 models identified. Akaike information criterion (AIC), percent deviance explained and Mean Absolute Error (MAE) were used to assess model performance. Bolded values represent the model with the best performance for a given metric. Treatment is a factor variable which designates whether the location was in a beaver pond or the downstream reference location. All models dependent variable was the catch per unit trap of Coho and the model family is a Tweedie distribution with a log link function.</p>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 45%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
</colgroup>
<thead><tr class="header">
<th>Model</th>
<th>Model Covariates</th>
<th>AIC</th>
<th>% Deviance Explained</th>
<th>MAE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Model 1</td>
<td>Dissolved oxygen * treatment<br>Temperature * treatment<br>Water depth * treatment<br>Mainstream distance * treatment<br>Ice thickness * treatment<br>Conductivity * treatment<br>pH * treatment<br>Site (random effect)</td>
<td>531.6</td>
<td>80.2</td>
<td>2.33</td>
</tr>
<tr class="even">
<td>Model 2</td>
<td>Dissolved oxygen * treatment<br>Temperature * treatment<br>Water depth * treatment<br>Mainstream distance * treatment<br>Ice thickness * treatment<br>pH * treatment<br>Site (random effect)</td>
<td><strong>529</strong></td>
<td><strong>80.4</strong></td>
<td><strong>2.30</strong></td>
</tr>
<tr class="odd">
<td>Model 3</td>
<td>Dissolved oxygen * treatment<br>Water depth * treatment<br>Mainstream distance * treatment<br>Ice thickness * treatment<br>pH * treatment<br>Site (random effect)</td>
<td>534.5</td>
<td>77.8</td>
<td>2.52</td>
</tr>
<tr class="even">
<td>Model 4</td>
<td>Dissolved oxygen * treatment<br>Temperature * treatment<br>Water depth * treatment<br>Mainstream distance * treatment<br>Ice thickness * treatment<br>Site (random effect)</td>
<td>534</td>
<td>78.3</td>
<td>2.54</td>
</tr>
<tr class="odd">
<td>Model 5</td>
<td>Dissolved oxygen * treatment<br>Water depth * treatment<br>Mainstream distance * treatment<br>Ice thickness * treatment<br>Site (random effect)</td>
<td>537</td>
<td>76.3</td>
<td>2.67</td>
</tr>
</tbody>
</table>
<p>Significant covariates on CPUT of coho in the best fit model included the dissolved oxygen in reference locations (p = 0.026), the mainstream distance of a beaver pond (p = 0.03), the ice thickness in a beaver pond (p = 0.045) and the pH in a beaver pond (p = 0.050; Table 2). Additionally, we found a marginal effect of water depth within beaver ponds on CPUT of coho (p = 0.076; Table 2).</p>
<p><strong>Table 2.</strong> Summary statistics of the best fit model: Catch per unit trap of Coho ~ s(Dissolved oxygen, by = Treatment) + s(Temperature, by = Treatment) + s(Water depth, by = Treatment) + s(Mainstream distance, by = Treatment) + s(Ice thickness, by = Treatment) + s(pH, by = Treatment) + s(Site, bs = “re). edf = effective degrees of freedom, Ref.df = reference degrees of freedom. Model family is a Tweedie distribution with a log link function. Adjusted R-squared = 0.84, Deviance explained = 80.4, - REML = 267.47.</p>
<table class="table">
<colgroup>
<col style="width: 48%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 14%">
</colgroup>
<thead><tr class="header">
<th>Covariates</th>
<th style="text-align: center;">edf</th>
<th style="text-align: center;">Ref. df</th>
<th style="text-align: center;">F-Statistic</th>
<th style="text-align: center;">P-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Dissolved oxygen:Beaver pond</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.284</td>
<td style="text-align: center;">0.595</td>
</tr>
<tr class="even">
<td>Dissolved oxygen:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4.622</td>
<td style="text-align: center;"><strong>0.026</strong></td>
</tr>
<tr class="odd">
<td>Temperature:Beaver pond</td>
<td style="text-align: center;">2.98</td>
<td style="text-align: center;">3.74</td>
<td style="text-align: center;">0.868</td>
<td style="text-align: center;">0.376</td>
</tr>
<tr class="even">
<td>Temperature:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.793</td>
<td style="text-align: center;">0.378</td>
</tr>
<tr class="odd">
<td>Water depth:Beaver pond</td>
<td style="text-align: center;">2.49</td>
<td style="text-align: center;">3.074</td>
<td style="text-align: center;">2.276</td>
<td style="text-align: center;"><em>0.076</em></td>
</tr>
<tr class="even">
<td>Water depth:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1.824</td>
<td style="text-align: center;">0.160</td>
</tr>
<tr class="odd">
<td>Mainstream distance:Beaver pond</td>
<td style="text-align: center;">3.13</td>
<td style="text-align: center;">3.437</td>
<td style="text-align: center;">2.298</td>
<td style="text-align: center;"><strong>0.033</strong></td>
</tr>
<tr class="even">
<td>Mainstream distance:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1.998</td>
<td style="text-align: center;">0.147</td>
</tr>
<tr class="odd">
<td>Ice thickness:Beaver pond</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4.275</td>
<td style="text-align: center;"><strong>0.045</strong></td>
</tr>
<tr class="even">
<td>Ice thickness:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.371</td>
<td style="text-align: center;">0.353</td>
</tr>
<tr class="odd">
<td>pH:Beaver pond</td>
<td style="text-align: center;">2.23</td>
<td style="text-align: center;">2.62</td>
<td style="text-align: center;">2.021</td>
<td style="text-align: center;"><strong>0.050</strong></td>
</tr>
<tr class="even">
<td>pH:Reference site</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">1.001</td>
<td style="text-align: center;">0.428</td>
</tr>
<tr class="odd">
<td>Site</td>
<td style="text-align: center;">3.93</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">2.231</td>
<td style="text-align: center;"><strong>0.002</strong></td>
</tr>
</tbody>
</table>
<p>The partial effects plots showed dissolved oxygen at the reference sites had a significant negative relationship with coho CPUT (Figure 2a).The best fit model also showed clear patterns of coho CPUT based on water depth, mainstem distance, ice thickness and pH in beaver ponds (Table 2). Although not significant, temperature within beaver ponds displayed an unimodal shape with CPUT of coho, peaking near 2° C (Figure 2b). Similarly, water depth within beaver ponds had an unimodal shape, peaking near 0.75 m (Figure 2d). The mainstem distance effect appeared to have a threshold effect near 750m, after which there was a negative relationship between the distance and coho CPUT (Figure 2c). Ice thickness had a negative relationship on CPUT of coho in beaver ponds (Figure 2e). Lastly, pH within beaver ponds seems to have an inverse J-shape to the relationship (Figure 2f).These results suggest beaver pond enhancement of coho CPUT may be most effective in areas of low dissolved oxygen, beaver ponds which display moderate levels of depth and temperature, low ice thickness, low pH and nearer to the mainstream of the river.</p>
<p>As expected, there was also a significant random effect of site (p = 0.002), suggesting that some unmeasured variability contributed significantly to the coho CPUT across different study sites. This can be seen in most of the effects plots having clear clustering, with the exception of water depth and pH which appeared more evenly distributed (Figure 2d,f). The effect plots by treatment give more nuance to the concept of enhancement. For example, although there was no clear pattern for DO in beaver ponds, among the paired sites, enhancement appears to take place in the areas that had a high DO at the reference sites (e.g., Whiskers Creek Side Slough, Figure 2).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="Figure2_covariate_partial_effects_plots_best_mod.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 2. The partial effects plots of the five covariates that were identified in the best fitting model of coho CPUT. Each row is a different covariate, labeled by the title on the upper left side of the plot. The left column is the partial effect plots in the beaver ponds and the right column is the partial effects plots in the reference locations. Points overlaid on graphs represent the environmental covariate by coho catch of a single trap (while holding all other covariates constant) at each site (coded by color).</figcaption></figure>
</div>
</section><section id="references" class="level3"><h3 class="anchored" data-anchor-id="references"><strong>References</strong></h3>
<p>Dormann, C.F., Elith, J., Bacher, S., Buchmann, C., Carl, G., Carré, G., Marquéz, J.R.G., Gruber, B., Lafourcade, B., Leitão, P.J. and Münkemüller, T., 2013. Collinearity: a review of methods to deal with it and a simulation study evaluating their performance. Ecography, 36(1), pp.27-46.</p>
<p>West, B.T., Welch, K.B. and Galecki, A.T., 2022. Linear mixed models: a practical guide using statistical software. Chapman and Hall/CRC.</p>
<p>Wood, S. N. 2011. Fast stable restricted maximum likelihood and marginal likelihood estimation of semiparametric generalized linear models. In Journal of the Royal Statistical Society (B) (Vol. 73, Issue 1, pp.&nbsp;3–36).</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>